---
import { siteConfig } from "@config/site.config";
import Button from "@components/ui/Button.astro";
import { Icon } from "astro-icon/components";

import { locations } from "@data/locations";

const navLinks = [
    { name: "Services", href: "/services" },
    { name: "Service Areas", href: "/service-areas" },
    { name: "FAQ", href: "/faq" },
    { name: "Reviews", href: "/reviews" },
    { name: "About", href: "/about" },
    {
        name: "Contact",
        href: "/contact?utm_source=website&utm_medium=cta&utm_campaign=header",
    },
];
---

<header class="fixed top-0 left-0 right-0 z-50 bg-cream-100 shadow-md">
    <div class="container mx-auto px-4">
        <div class="flex items-center justify-between h-20">
            <!-- Logo -->
            <a href="/" class="flex items-center flex-shrink-0">
                <img
                    src="/images/logos/ez2fix-logo.png"
                    alt="Ez2Fix LLC - Licensed Garage Door Repair Northern NJ"
                    class="w-20 lg:w-auto lg:h-16"
                    width="200"
                    height="48"
                />
            </a>

            <!-- Desktop Navigation -->
            <nav class="hidden lg:flex items-center space-x-6">
                {
                    navLinks.map((link) => {
                        if (link.name === "Services") {
                            return (
                                <div class="relative group">
                                    <button class="flex items-center text-dark-700 hover:text-gold-600 font-semibold transition-colors focus:outline-none py-6">
                                        Services
                                        <Icon
                                            name="heroicons:chevron-down"
                                            class="w-4 h-4 ml-1 transition-transform group-hover:rotate-180"
                                        />
                                    </button>
                                    <div class="hidden absolute left-0 top-full w-[800px] bg-white shadow-xl rounded-xl border border-gold-200/20 group-hover:block p-6 z-50">
                                        <div class="grid grid-cols-3 gap-4">
                                            {[
                                                {
                                                    name: "Emergency Repair",
                                                    href: "/services/emergency-repair",
                                                    icon: "heroicons:bolt",
                                                },
                                                {
                                                    name: "Spring Repair",
                                                    href: "/services/spring-repair",
                                                    icon: "heroicons:cog",
                                                },
                                                {
                                                    name: "Opener Installation",
                                                    href: "/services/opener-installation",
                                                    icon: "heroicons:arrow-up-on-square",
                                                },
                                                {
                                                    name: "Door Installation",
                                                    href: "/services/door-installation",
                                                    icon: "heroicons:home",
                                                },
                                                {
                                                    name: "Opener Repair",
                                                    href: "/services/opener-repair",
                                                    icon: "heroicons:wrench",
                                                },
                                                {
                                                    name: "Cable Repair",
                                                    href: "/services/cable-repair",
                                                    icon: "heroicons:link",
                                                },
                                                {
                                                    name: "Panel Replacement",
                                                    href: "/services/panel-replacement",
                                                    icon: "heroicons:squares-plus",
                                                },
                                                {
                                                    name: "Track Repair",
                                                    href: "/services/track-repair",
                                                    icon: "heroicons:bars-3-bottom-left",
                                                },
                                                {
                                                    name: "Commercial Garage Door",
                                                    href: "/services/commercial-garage-door",
                                                    icon: "heroicons:building-office",
                                                },
                                            ].map((service) => (
                                                <a
                                                    href={service.href}
                                                    class="flex items-start p-3 rounded-lg hover:bg-gold-50 transition-colors group/item"
                                                >
                                                    <div class="flex-shrink-0 mt-1">
                                                        <Icon
                                                            name={service.icon}
                                                            class="w-5 h-5 text-gold-500 group-hover/item:text-gold-600"
                                                        />
                                                    </div>
                                                    <div class="ml-3">
                                                        <p class="text-sm font-bold text-dark-900 group-hover/item:text-gold-700">
                                                            {service.name}
                                                        </p>
                                                    </div>
                                                </a>
                                            ))}
                                        </div>
                                        <div class="mt-6 pt-4 border-t border-gray-200">
                                            <a
                                                href="/services"
                                                class="flex items-center justify-center px-6 py-3 bg-gold-500 text-dark-900 rounded-lg font-bold hover:bg-gold-600 hover:text-white transition-all shadow-md hover:shadow-lg group/link"
                                            >
                                                View All Services
                                                <Icon
                                                    name="heroicons:arrow-right"
                                                    class="w-5 h-5 ml-2 transition-transform group-hover/link:translate-x-1"
                                                />
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            );
                        } else if (link.name === "Service Areas") {
                            return (
                                <div class="relative group">
                                    <button class="flex items-center text-dark-700 hover:text-gold-600 font-semibold transition-colors focus:outline-none py-6">
                                        Service Areas
                                        <Icon
                                            name="heroicons:chevron-down"
                                            class="w-4 h-4 ml-1 transition-transform group-hover:rotate-180"
                                        />
                                    </button>
                                    <div class="hidden absolute left-0 top-full w-[700px] bg-white shadow-xl rounded-xl border border-gold-200/20 group-hover:block p-6 z-50">
                                        <div class="grid grid-cols-4 gap-4">
                                            {locations.map((location) => (
                                                <a
                                                    href={`/service-areas/${location.slug}`}
                                                    class="flex items-center p-2 rounded-lg hover:bg-gold-50 transition-colors group/item"
                                                >
                                                    <Icon
                                                        name="heroicons:map-pin"
                                                        class="w-4 h-4 text-gold-500 mr-2 group-hover/item:text-gold-600"
                                                    />
                                                    <span class="text-sm font-medium text-dark-700 group-hover/item:text-gold-700">
                                                        {location.city}
                                                    </span>
                                                </a>
                                            ))}
                                        </div>
                                        <div class="mt-6 pt-4 border-t border-gray-200">
                                            <a
                                                href="/service-areas"
                                                class="flex items-center justify-center px-6 py-3 bg-gold-500 text-dark-900 rounded-lg font-bold hover:bg-gold-600 hover:text-white transition-all shadow-md hover:shadow-lg group/link"
                                            >
                                                View All Service Areas
                                                <Icon
                                                    name="heroicons:arrow-right"
                                                    class="w-5 h-5 ml-2 transition-transform group-hover/link:translate-x-1"
                                                />
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            );
                        } else {
                            return (
                                <a
                                    href={link.href}
                                    class="text-dark-700 hover:text-gold-600 font-semibold transition-colors"
                                >
                                    {link.name}
                                </a>
                            );
                        }
                    })
                }
            </nav>

            <!-- Desktop CTAs -->
            <div class="hidden lg:flex items-center space-x-4">
                <Button
                    variant="secondary"
                    size="md"
                    href={`tel:${siteConfig.contact.phoneRaw}`}
                >
                    <Icon name="heroicons:phone" class="w-5 h-5 mr-2" />
                    Call {siteConfig.contact.phone}
                </Button>
                <Button
                    variant="primary"
                    size="md"
                    href="/booking?utm_source=website&utm_medium=cta&utm_campaign=header"
                >
                    <Icon name="heroicons:calendar" class="w-5 h-5 mr-2" />
                    Book Online
                </Button>
            </div>

            <!-- Mobile Right Section (CTAs + Menu) -->
            <div
                class="flex lg:hidden items-center space-x-3 max-[375px]:space-x-1 ml-auto"
            >
                <!-- Mobile CTAs -->
                <div class="flex items-center space-x-2 max-[375px]:space-x-1">
                    <a
                        href={`tel:${siteConfig.contact.phoneRaw}`}
                        class="flex items-center justify-center px-3 py-1.5 max-[375px]:px-1.5 max-[375px]:py-1 text-dark-900 border-2 border-dark-900 rounded-lg hover:bg-gray-50 transition-all font-bold text-xs max-[375px]:text-[10px] whitespace-nowrap"
                        aria-label="Call Now"
                    >
                        <Icon
                            name="heroicons:phone"
                            class="w-4 h-4 max-[375px]:w-3.5 max-[375px]:h-3.5"
                        />
                        <span class="ml-1.5 max-[330px]:hidden">Call Now</span>
                    </a>
                    <a
                        href="/booking?utm_source=website&utm_medium=cta&utm_campaign=header"
                        class="flex items-center justify-center px-3 py-1.5 max-[375px]:px-1.5 max-[375px]:py-1 bg-gold-500 text-dark-900 rounded-lg font-bold text-xs max-[375px]:text-[10px] hover:bg-gold-600 hover:text-white transition-all whitespace-nowrap"
                        aria-label="Book Online"
                    >
                        <Icon
                            name="heroicons:calendar"
                            class="w-4 h-4 max-[375px]:w-3.5 max-[375px]:h-3.5"
                        />
                        <span class="ml-1.5">Book Online</span>
                    </a>
                </div>

                <!-- Mobile Menu Button -->
                <button
                    id="mobile-menu-button"
                    class="p-1 text-dark-700 hover:text-gold-600"
                    aria-label="Toggle menu"
                >
                    <Icon
                        name="heroicons:bars-3"
                        class="w-7 h-7 max-[375px]:w-6 max-[375px]:h-6"
                    />
                </button>
            </div>
        </div>
    </div>

    <!-- Mobile Menu -->
    <div
        id="mobile-menu"
        class="hidden lg:hidden bg-white border-t border-gray-200"
    >
        <nav class="container mx-auto px-4 py-4 flex flex-col space-y-2">
            {
                navLinks.map((link) => {
                    if (link.name === "Services") {
                        return (
                            <div class="border-b border-gray-200 pb-2">
                                <button
                                    class="mobile-dropdown-trigger w-full flex items-center justify-between text-dark-700 hover:text-gold-600 font-semibold transition-colors py-2"
                                    data-target="mobile-services"
                                >
                                    <span class="flex items-center">
                                        <Icon
                                            name="heroicons:wrench-screwdriver"
                                            class="w-5 h-5 mr-2 text-gold-500"
                                        />
                                        Services
                                    </span>
                                    <Icon
                                        name="heroicons:chevron-down"
                                        class="w-5 h-5 transition-transform duration-200"
                                    />
                                </button>
                                <div
                                    id="mobile-services"
                                    class="hidden mt-2 ml-4 space-y-2"
                                >
                                    {[
                                        {
                                            name: "Emergency Repair",
                                            href: "/services/emergency-repair",
                                            icon: "heroicons:bolt",
                                        },
                                        {
                                            name: "Spring Repair",
                                            href: "/services/spring-repair",
                                            icon: "heroicons:cog",
                                        },
                                        {
                                            name: "Opener Installation",
                                            href: "/services/opener-installation",
                                            icon: "heroicons:arrow-up-on-square",
                                        },
                                        {
                                            name: "Door Installation",
                                            href: "/services/door-installation",
                                            icon: "heroicons:home",
                                        },
                                        {
                                            name: "Opener Repair",
                                            href: "/services/opener-repair",
                                            icon: "heroicons:wrench",
                                        },
                                        {
                                            name: "Cable Repair",
                                            href: "/services/cable-repair",
                                            icon: "heroicons:link",
                                        },
                                        {
                                            name: "Panel Replacement",
                                            href: "/services/panel-replacement",
                                            icon: "heroicons:squares-plus",
                                        },
                                        {
                                            name: "Track Repair",
                                            href: "/services/track-repair",
                                            icon: "heroicons:bars-3-bottom-left",
                                        },
                                        {
                                            name: "Commercial Garage Door",
                                            href: "/services/commercial-garage-door",
                                            icon: "heroicons:building-office",
                                        },
                                    ].map((service) => (
                                        <a
                                            href={service.href}
                                            class="flex items-center text-sm text-dark-600 hover:text-gold-600 py-1.5 transition-colors"
                                        >
                                            <Icon
                                                name={service.icon}
                                                class="w-4 h-4 mr-2 text-gold-500 flex-shrink-0"
                                            />
                                            {service.name}
                                        </a>
                                    ))}
                                    <a
                                        href="/services"
                                        class="block mt-3 pt-3 border-t border-gray-100 text-sm font-bold text-gold-600 hover:text-gold-700 flex items-center"
                                    >
                                        <Icon
                                            name="heroicons:wrench-screwdriver"
                                            class="w-4 h-4 mr-1.5"
                                        />
                                        View All Services
                                    </a>
                                </div>
                            </div>
                        );
                    } else if (link.name === "Service Areas") {
                        return (
                            <div class="border-b border-gray-200 pb-2">
                                <button
                                    class="mobile-dropdown-trigger w-full flex items-center justify-between text-dark-700 hover:text-gold-600 font-semibold transition-colors py-2"
                                    data-target="mobile-areas"
                                >
                                    <span class="flex items-center">
                                        <Icon
                                            name="heroicons:map-pin"
                                            class="w-5 h-5 mr-2 text-gold-500"
                                        />
                                        Service Areas
                                    </span>
                                    <Icon
                                        name="heroicons:chevron-down"
                                        class="w-5 h-5 transition-transform duration-200"
                                    />
                                </button>
                                <div
                                    id="mobile-areas"
                                    class="hidden mt-2 ml-4 grid grid-cols-2 gap-2"
                                >
                                    {locations.map((location) => (
                                        <a
                                            href={`/service-areas/${location.slug}`}
                                            class="flex items-center text-sm text-dark-600 hover:text-gold-600 py-1 transition-colors"
                                        >
                                            <Icon
                                                name="heroicons:map-pin"
                                                class="w-3.5 h-3.5 mr-1.5 text-gold-400 flex-shrink-0"
                                            />
                                            {location.city}
                                        </a>
                                    ))}
                                    <a
                                        href="/service-areas"
                                        class="col-span-2 mt-2 pt-2 border-t border-gray-100 text-sm font-bold text-gold-600 hover:text-gold-700 flex items-center justify-center"
                                    >
                                        <Icon
                                            name="heroicons:map-pin"
                                            class="w-4 h-4 mr-1.5"
                                        />
                                        View All Service Areas
                                    </a>
                                </div>
                            </div>
                        );
                    } else {
                        return (
                            <a
                                href={link.href}
                                class="flex items-center text-dark-700 hover:text-gold-600 font-semibold transition-colors py-2 border-b border-gray-200 pb-2"
                            >
                                {link.name === "FAQ" && (
                                    <Icon
                                        name="heroicons:question-mark-circle"
                                        class="w-5 h-5 mr-2 text-gold-500"
                                    />
                                )}
                                {link.name === "Reviews" && (
                                    <Icon
                                        name="heroicons:star-solid"
                                        class="w-5 h-5 mr-2 text-gold-500"
                                    />
                                )}
                                {link.name === "About" && (
                                    <Icon
                                        name="heroicons:information-circle"
                                        class="w-5 h-5 mr-2 text-gold-500"
                                    />
                                )}
                                {link.name === "Contact" && (
                                    <Icon
                                        name="heroicons:envelope"
                                        class="w-5 h-5 mr-2 text-gold-500"
                                    />
                                )}
                                {link.name}
                            </a>
                        );
                    }
                })
            }
            <div class="pt-4 border-t border-gray-200 flex flex-col space-y-3">
                <Button
                    variant="secondary"
                    size="md"
                    href={`tel:${siteConfig.contact.phoneRaw}`}
                >
                    <Icon name="heroicons:phone" class="w-5 h-5 mr-2" />
                    Call Now
                </Button>
                <Button
                    variant="primary"
                    size="md"
                    href="/booking?utm_source=website&utm_medium=cta&utm_campaign=header"
                >
                    <Icon name="heroicons:calendar" class="w-5 h-5 mr-2" />
                    Book Online
                </Button>
            </div>
        </nav>
    </div>
</header>

<script>
    const menuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");

    menuButton?.addEventListener("click", () => {
        mobileMenu?.classList.toggle("hidden");
    });

    // Mobile dropdown functionality
    const dropdownTriggers = document.querySelectorAll(
        ".mobile-dropdown-trigger",
    );

    dropdownTriggers.forEach((trigger) => {
        trigger.addEventListener("click", () => {
            const targetId = trigger.getAttribute("data-target") || "";
            const targetElement = document.getElementById(targetId);
            const chevron = trigger.querySelector("svg");

            if (targetElement && chevron) {
                targetElement.classList.toggle("hidden");
                chevron.classList.toggle("rotate-180");
            }
        });
    });
</script>
