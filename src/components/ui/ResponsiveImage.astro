---
interface Props {
    src: string;
    alt: string;
    width: number;
    height: number;
    sizes?: string;
    loading?: "lazy" | "eager";
    fetchpriority?: "high" | "low" | "auto";
    class?: string;
}

const {
    src,
    alt,
    width,
    height,
    sizes = "100vw",
    loading = "lazy",
    fetchpriority = "auto",
    class: className,
    ...rest
} = Astro.props;

// Helper to generate WebP path
const getWebPPath = (path: string) => {
    return path.replace(/\.(jpg|jpeg|png)$/i, ".webp");
};

const webpSrc = getWebPPath(src);
---

<picture>
    <!-- 
      The WebP source is enabled to serve next-gen image formats.
      For this to work correctly, ensure that for every .jpg or .png image
      referenced by this component, a corresponding .webp version exists in the same directory.
      If the .webp image is missing, the browser will fall back to the original `src` below,
      but it will result in a 404 request for the .webp file.
    -->
    <source srcset={webpSrc} type="image/webp" />
    <img
        src={src}
        alt={alt}
        width={width}
        height={height}
        sizes={sizes}
        loading={loading}
        fetchpriority={fetchpriority}
        class={className}
        decoding="async"
        {...rest}
    />
</picture>
